{% extends "base.html" %} {% block body %} {% include "nav.html" %}

<div class="container">

    <div class="row mt-5 mb-5">
        <div class="col-12">
            <h2>Actual stage</h2>
            <div class="row">
                <div class="col-md-3">
                    <div id="stage" class="big-number"></div>
                    <div class="big-number-label">
                        stage
                    </div>
                </div>
                <div class="col-md-3">
                    <div id="stage_delta" class="big-number"></div>
                    <div class="big-number-label">
                        stage delta time
                    </div>
                </div>
                <div class="col-md-3">
                    <div id="total_delta" class="big-number"></div>
                    <div class="big-number-label">
                        total delta time
                    </div>
                </div>
                <div class="col-md-3">
                    <div id="next_start" class="big-number"></div>
                    <div class="big-number-label">
                        time to next start
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-5">
        <h2>Crawler</h2>
    </div>
    <div class="row">
        <div class="col-xl-6">
            <canvas id="page_types" height="200px"></canvas>
        </div>
        <div class="col-xl-6">
            <canvas id="progress" height="200px"></canvas>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col-12">
            <h2>Stats</h2>
            <div class="row">
                <div class="col-md-3">
                    <div id="target_domain" class="big-number"></div>
                    <div class="big-number-label">
                        target domain
                    </div>
                </div>
                <div class="col-md-3">
                    <div id="number_of_domains" class="big-number"></div>
                    <div class="big-number-label">
                        number of domains
                    </div>
                </div>
                <div class="col-md-3">
                    <div id="number_of_servers" class="big-number"></div>
                    <div class="big-number-label">
                        number of servers
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row mt-5 mb-5">
        <div class="col-xl-8">
            <h2>Pagerank</h2>
            <div class="row">
                <div class="col-4">
                    <div id="pagerank_graph" class="big-number"></div>
                    <div class="big-number-label">
                        graph
                    </div>
                </div>
                <div class="col-4">
                    <div id="pagerank_calculation" class="big-number"></div>
                    <div class="big-number-label">
                        calculation
                    </div>
                </div>
                <div class="col-4">
                    <div id="pagerank_uploading" class="big-number"></div>
                    <div class="big-number-label">
                        uploading
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-4">
            <h2>Indexer</h2>
            <div class="row">
                <div class="col-12">
                    <div id="indexer" class="big-number"></div>
                    <div class="big-number-label">
                        indexed (pages)
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


{% include "footer.html" %} {% endblock %} {% block scripts %}
<script>
    var $SCRIPT_ROOT = {{request.script_root | tojson | safe}};

    $(document).ready(function() {
        setInterval("reload()", 10000); // call every 10 seconds
    });

    var legend = {
        display: true,
        position: 'bottom',
    };
    var layout = {
        padding: {
            left: 0,
            right: 0,
            top: 40,
            bottom: 40
        }
    };

    var page_types = document.getElementById('page_types').getContext('2d');

    var page_types = new Chart(page_types, {
        type: 'bar',

        data: {

            labels: [],
            datasets: [{
                data: [],
                backgroundColor: [
                    "#4A90E2",
                    "#F5A623",
                    "#D0021B",
                    "#50E3C2",
                    "#9013FE",
                ],
            }],
        },

        options: {
            legend: {
                display: false
            },
            layout: layout,
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });


    var progress = document.getElementById('progress').getContext('2d');
    var queue = new Chart(progress, {
        type: 'doughnut',
        data: {
            labels: [],
            datasets: [{
                data: [],
                backgroundColor: [
                    "#F5A623",
                    "#D0021B",
                    "#50E3C2"
                ],
            }],
        },
        options: {
            legend: legend,
            layout: layout,
        }
    });

    function reload() {
        $.getJSON($SCRIPT_ROOT + '/api/stats', function(data) {
            $("#target_domain").text(data.target_domain)
            $("#stage").text(data.stage)
            $("#stage_delta").text(data.stage_delta_time)
            $("#total_delta").text(data.total_delta_time)
            $("#next_start").text(data.next_time_start)
            $("#pagerank_graph").text(data.pagerank_graph_deltatime)
            $("#pagerank_calculation").text(data.pagerank_calculation_deltatime)
            $("#pagerank_uploading").text(data.pagerank_uploading_deltatime)
            $("#number_of_domains").text(data.number_of_domains)
            $("#number_of_servers").text(data.number_of_servers)
            $("#indexer").text(data.indexer_progress + '/' + data.indexer_total)
            page_types.data.datasets[0].data = data.crawler_progress_values
            page_types.data.labels = data.crawler_progress_labels
            queue.data.datasets[0].data = data.crawler_queue_values
            queue.data.labels = data.crawler_queue_labels
            page_types.update();
            queue.update()
        });
    }

    reload();
</script>
{% endblock %}
